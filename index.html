<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tesoura — Controle do Futebol</title>
  <style>
    :root{
      --bg:#07101f;
      --card:#0b1630;
      --line:#1b2c57;
      --txt:#eaf0ff;
      --muted:#a8b4d6;
      --accent:#f39c12;
      --green:#2bd39f;
      --blue:#4b7cff;
      --danger:#ff4b4b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:radial-gradient(1200px 600px at 20% 0%, #132246 0%, var(--bg) 55%) fixed;
      color:var(--txt);
      overflow-x:hidden; /* evita barra horizontal na página */
    }
    a{color:inherit}

    .wrap{max-width:1600px;margin:0 auto;padding:14px 10px}
    .top{
      border:1px solid var(--line);
      background:rgba(11,22,48,.75);
      border-radius:16px;
      padding:12px 14px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .brand{display:flex;align-items:center;gap:10px;min-width:0}
    .logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#ffd08a);display:grid;place-items:center;color:#091226;font-weight:900}
    .title{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .sub{color:var(--muted);font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .right{display:flex;align-items:center;gap:10px}
    .role{
      font-weight:900;color:#091226;background:var(--accent);
      border-radius:999px;padding:6px 10px;font-size:12px;
      white-space:nowrap;
    }
    .btnExit{
      border:1px solid var(--line);background:transparent;color:var(--txt);
      border-radius:12px;padding:8px 12px;font-weight:900;cursor:pointer;
    }

    .nav{
      margin-top:12px;
      border:1px solid var(--line);
      background:rgba(11,22,48,.55);
      border-radius:16px;
      padding:10px;
    }

    /* MENU: 1 linha + rolagem horizontal sem mostrar barra */
    .tabs{
      display:flex;gap:10px;flex-wrap:nowrap;
      overflow-x:auto;-webkit-overflow-scrolling:touch;
      scrollbar-width:none;
    }
    .tabs::-webkit-scrollbar{display:none;}

    .tab{
      flex:0 0 auto;
      display:inline-flex;align-items:center;justify-content:center;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:transparent;
      color:var(--txt);
      font-weight:900;
      cursor:pointer;
      text-decoration:none;
      white-space:nowrap;
    }
    .tab.active{background:rgba(255,255,255,.07)}
    .tab.disabled{opacity:.35;pointer-events:none}

    .content{
      margin-top:12px;
      border:1px solid var(--line);
      background:rgba(11,22,48,.55);
      border-radius:16px;
      padding:10px;
      min-height:420px;
    }
    iframe{
      width:100%;
      height:78vh;
      min-height:520px;
      border:0;
      border-radius:12px;
      background:rgba(0,0,0,.15);
    }

    /* MODAL LOGIN */
    .modal{
      position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
      background:rgba(0,0,0,.62);padding:14px;z-index:9999;
    }
    .modalCard{
      width:min(720px, 96vw);
      border:1px solid var(--line);
      background:rgba(11,22,48,.92);
      border-radius:18px;
      padding:18px;
      box-shadow:0 18px 60px rgba(0,0,0,.45);
    }
    .modalH1{margin:0 0 6px;color:var(--accent);font-weight:1000;letter-spacing:.6px;text-align:center}
    .modalP{margin:0 0 12px;color:var(--muted);font-size:13px;text-align:center}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:720px){ .grid2{grid-template-columns:1fr} }

    .box{
      border:1px solid var(--line);border-radius:14px;padding:12px;background:rgba(255,255,255,.03)
    }
    .boxTitle{font-weight:1000;margin:0 0 6px}
    .boxNote{color:var(--muted);font-size:12px;margin:0 0 10px}
    label{display:block;color:var(--muted);font-size:12px;margin:8px 0 6px}
    input{
      width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);
      background:#0a142b;color:var(--txt);outline:none;
      font-weight:900;
    }
    .rowBtns{display:flex;gap:10px;margin-top:10px}
    .btnG{
      flex:1;border:0;border-radius:12px;padding:12px 14px;
      font-weight:1000;cursor:pointer;color:#061019;
      background:linear-gradient(135deg,#28d7a2,#1aa98e);
    }
    .btnB{
      flex:1;border:0;border-radius:12px;padding:12px 14px;
      font-weight:1000;cursor:pointer;color:#07101f;
      background:linear-gradient(135deg,#5f86ff,#3f69ff);
    }
    .msg{
      margin-top:10px;font-size:13px;color:#ffcf7a;text-align:center;min-height:18px;
    }
    .mini{
      margin-top:10px;color:var(--muted);font-size:12px;line-height:1.4
    }
    .mini b{color:var(--txt)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo">T</div>
        <div style="min-width:0">
          <div class="title">Tesoura — Controle do Futebol</div>
          <div class="sub" id="subInfo">Aguardando login…</div>
        </div>
      </div>
      <div class="right">
        <div class="role" id="roleTag">MODO: —</div>
        <button class="btnExit" id="btnSair">SAIR</button>
      </div>
    </div>

    <div class="nav">
      <div class="tabs" id="tabs">
        <a class="tab active" data-tab="jogadores" href="#" onclick="return false;">JOGADORES</a>
        <a class="tab" data-tab="presenca" href="#" onclick="return false;">PRESENÇA / ESCALAÇÃO</a>
        <a class="tab" data-tab="controle" href="#" onclick="return false;">CONTROLE GERAL</a>
        <a class="tab" data-tab="mensalidade" href="#" onclick="return false;">MENSALIDADE</a>
        <a class="tab" data-tab="caixa" href="#" onclick="return false;">CAIXA</a>
        <a class="tab" data-tab="gols" href="#" onclick="return false;">GOLS</a>
        <a class="tab" data-tab="banco" href="#" onclick="return false;">BANCO DE DADOS</a>
      </div>
    </div>

    <div class="content">
      <iframe id="frame" src="about:blank" title="Tesoura"></iframe>
    </div>
  </div>

  <!-- MODAL LOGIN -->
  <div class="modal" id="loginModal">
    <div class="modalCard">
      <h2 class="modalH1">GRUPO TESOURA I</h2>
      <p class="modalP">Escolha o acesso e digite a senha (senhas visíveis, como você pediu).</p>

      <div class="grid2">
        <div class="box">
          <div class="boxTitle">Jogadores (VISUAL)</div>
          <p class="boxNote">Somente visualização (sem edição).</p>

          <label>Senha dos Jogadores</label>
          <input id="pinJog" type="text" placeholder="TESOURA2026" />

          <div class="rowBtns">
            <button class="btnG" id="btnJog">ENTRAR JOGADORES</button>
          </div>
        </div>

        <div class="box">
          <div class="boxTitle">Diretoria (EDITA)</div>
          <p class="boxNote">Edita tudo. Alguns diretores podem ficar “sem Caixa”.</p>

          <label>Senha da Diretoria</label>
          <input id="pinDir" type="text" placeholder="1baidec / 2thiago / 3love / 4le / 5titi" />

          <div class="rowBtns">
            <button class="btnB" id="btnDir">ENTRAR DIRETORIA</button>
          </div>
        </div>
      </div>

      <div class="mini">
        <b>REGRA:</b> Jogadores = <b>TESOURA2026</b> (visual).<br/>
        Diretoria: <b>1baidec</b>, <b>2thiago</b> = <b>COM CAIXA</b>. <b>3love</b>, <b>4le</b>, <b>5titi</b> = <b>SEM CAIXA</b>.
      </div>

      <div class="msg" id="loginMsg"></div>
    </div>
  </div>

  <!-- CONFIG (fonte única) -->
  <script src="app/js/config.js"></script>

  <script>
    const $ = (id)=>document.getElementById(id);

    const cfg = window.TESOURA_CONFIG || {};
    const PIN_JOG = String(cfg.APP_PIN || "TESOURA2026");

    const DIRETORES = cfg.DIRETORES || {
      "1baidec": { caixa: true },
      "2thiago": { caixa: true },
      "3love":   { caixa: false },
      "4le":     { caixa: false },
      "5titi":   { caixa: false }
    };

    const PAGES = {
      jogadores:   "tesoura_jogadores_teste.html",
      presenca:    "tesoura_presenca_escala_R5.html",
      controle:    "tesoura_controle_geral_teste.html",
      mensalidade: "tesoura_mensalidade_R4.html",
      caixa:       "tesoura_caixa_teste.html",
      gols:        "tesoura_gols_teste.html",
      banco:       "tesoura_banco_dados_teste.html"
    };

    function setRole(role, caixaAllowed){
      localStorage.setItem("TESOURA_ROLE", role);
      localStorage.setItem("TESOURA_CAIXA", caixaAllowed ? "1" : "0");
    }

    function getRole(){
      return localStorage.getItem("TESOURA_ROLE") || "";
    }

    function hasCaixa(){
      return (localStorage.getItem("TESOURA_CAIXA") || "0") === "1";
    }

    function applyUI(){
      const role = getRole();
      const caixaOk = hasCaixa();

      if(!role){
        $("roleTag").textContent = "MODO: —";
        $("subInfo").textContent = "Aguardando login…";
        $("loginModal").style.display = "flex";
        return;
      }

      $("loginModal").style.display = "none";

      if(role === "jogador"){
        $("roleTag").textContent = "MODO: Jogadores (VISUAL)";
        $("subInfo").textContent = "Acesso visual (sem edição).";
      } else {
        $("roleTag").textContent = caixaOk ? "MODO: Diretoria (COM CAIXA)" : "MODO: Diretoria (SEM CAIXA)";
        $("subInfo").textContent = "Acesso da Diretoria (edita).";
      }

      // Esconde o botão CAIXA se não puder
      const tabCaixa = document.querySelector('.tab[data-tab="caixa"]');
      if(tabCaixa){
        if(role === "jogador" || (role === "diretor" && !caixaOk)){
          tabCaixa.classList.add("disabled");
        }else{
          tabCaixa.classList.remove("disabled");
        }
      }

      // Se estiver numa aba proibida, volta para jogadores
      const active = document.querySelector(".tab.active")?.dataset?.tab || "jogadores";
      if(active === "caixa" && (role === "jogador" || !caixaOk)){
        setActiveTab("jogadores");
        loadTab("jogadores");
      }
    }

    function setActiveTab(tab){
      document.querySelectorAll(".tab").forEach(el=>{
        if(el.dataset.tab === tab) el.classList.add("active");
        else el.classList.remove("active");
      });
    }

    function loadTab(tab){
      const role = getRole();
      if(!role){ return; }

      if(tab === "caixa" && (role === "jogador" || (role==="diretor" && !hasCaixa()))){
        $("loginMsg").textContent = "Sem permissão para CAIXA.";
        return;
      }

      const src = PAGES[tab] || PAGES.jogadores;

      // passa modo para as páginas (se você quiser usar depois)
      const qs = `?role=${encodeURIComponent(role)}&caixa=${hasCaixa() ? "1" : "0"}`;
      $("frame").src = src + qs;

      // trava clique no iframe em modo jogador (visual)
      // (sem mexer nos seus painéis agora)
      setTimeout(()=>{
        if(getRole()==="jogador"){
          lockIframeVisual();
        }else{
          unlockIframe();
        }
      }, 400);
    }

    function lockIframeVisual(){
      const fr = $("frame");
      const parent = fr.parentElement;
      let ov = parent.querySelector("[data-ov='1']");
      if(!ov){
        ov = document.createElement("div");
        ov.dataset.ov="1";
        ov.style.position="absolute";
        ov.style.inset="10px";
        ov.style.borderRadius="12px";
        ov.style.pointerEvents="auto";
        ov.style.background="transparent";
        ov.title = "Modo Jogador: visual";
        parent.style.position = "relative";
        parent.appendChild(ov);
      }
    }

    function unlockIframe(){
      const parent = $("frame").parentElement;
      const ov = parent.querySelector("[data-ov='1']");
      if(ov) ov.remove();
    }

    // LOGIN (sem prompt)
    $("btnJog").onclick = ()=>{
      const pin = ($("pinJog").value || "").trim();
      if(pin !== PIN_JOG){
        $("loginMsg").textContent = "Senha de Jogadores incorreta.";
        return;
      }
      $("loginMsg").textContent = "";
      setRole("jogador", false);
      applyUI();
      loadTab(document.querySelector(".tab.active")?.dataset?.tab || "jogadores");
    };

    $("btnDir").onclick = ()=>{
      const pin = ($("pinDir").value || "").trim();
      const info = DIRETORES[pin];
      if(!info){
        $("loginMsg").textContent = "Senha de Diretoria incorreta.";
        return;
      }
      $("loginMsg").textContent = "";
      setRole("diretor", !!info.caixa);
      applyUI();
      loadTab(document.querySelector(".tab.active")?.dataset?.tab || "jogadores");
    };

    // SAIR
    $("btnSair").onclick = ()=>{
      localStorage.removeItem("TESOURA_ROLE");
      localStorage.removeItem("TESOURA_CAIXA");
      $("frame").src = "about:blank";
      applyUI();
    };

    // TABS
    $("tabs").addEventListener("click",(e)=>{
      const a = e.target.closest(".tab");
      if(!a) return;
      const tab = a.dataset.tab;
      if(a.classList.contains("disabled")) return;
      setActiveTab(tab);
      loadTab(tab);
    });

    // INICIO
    (function init(){
      // força login sempre ao abrir (como você quer)
      localStorage.removeItem("TESOURA_ROLE");
      localStorage.removeItem("TESOURA_CAIXA");
      setActiveTab("jogadores");
      applyUI();
    })();
  </script>
</body>
</html>
