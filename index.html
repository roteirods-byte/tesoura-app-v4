<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tesoura — Controle do Futebol</title>

  <style>
    :root{
      --bg:#07101f;
      --bg2:#0b1630;
      --card:#0b1a33;
      --line:#1a2c52;
      --text:#e8eefc;
      --muted:#9db0d6;
      --orange:#ff8a2a;
      --green:#18d37b;
      --blue:#66a8ff;
      --red:#ff4d4d;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#050a14);color:var(--text)}
    .topbar{position:sticky;top:0;z-index:10;background:rgba(5,10,20,.9);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,.06)}
    .topbar-inner{display:flex;align-items:center;gap:12px;padding:10px 14px}
    .logo{width:36px;height:36px;border-radius:10px;background:var(--orange);display:flex;align-items:center;justify-content:center;font-weight:800;color:#101}
    .titlewrap{display:flex;flex-direction:column;line-height:1.1}
    .t1{font-weight:800}
    .t2{font-size:12px;color:var(--muted)}
    .spacer{flex:1}
    .badge{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.09);font-size:12px;color:var(--muted)}
    .btnTop{padding:8px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);color:var(--text);cursor:pointer;font-weight:700}
    .btnTop.orange{background:var(--orange);border-color:transparent;color:#101}
    .btnTop:hover{filter:brightness(1.05)}

    .tabs{display:flex;gap:10px;padding:12px 14px;border-top:1px solid rgba(255,255,255,.04)}
    .tab{padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text);cursor:pointer;font-weight:800;font-size:13px}
    .tab.active{background:var(--orange);border-color:transparent;color:#101}
    .tab:hover{filter:brightness(1.05)}

    .wrap{max-width:1400px;margin:0 auto;padding:0 14px 20px}
    .frameWrap{border:1px solid rgba(255,255,255,.10);border-radius:16px;overflow:hidden;background:rgba(255,255,255,.03);position:relative}
    iframe{border:0}
    /* anti-flash: iframes empilhados + máscara */
    .frame{position:absolute;inset:0;width:100%;height:calc(100vh - 150px);background:#0b1220;display:none}
    .frame.active{display:block}
    .frameMask{position:absolute;inset:0;z-index:50;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.35);backdrop-filter:blur(2px)}
    .frameMask.hidden{display:none}
    .spinner{width:44px;height:44px;border-radius:50%;border:4px solid rgba(255,255,255,.25);border-top-color:#ff8c2a;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .msg{margin:10px 0 0;color:var(--red);font-weight:800;min-height:18px}

    /* LOGIN OVERLAY */
    .overlay{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      background:rgba(0,0,0,.55);backdrop-filter:blur(6px);z-index:999;
    }
    .modal{
      width:min(880px,94vw);
      background:linear-gradient(180deg,#0b1a33,#07101f);
      border:1px solid rgba(255,255,255,.14);
      border-radius:18px;
      box-shadow:0 30px 80px rgba(0,0,0,.55);
      padding:18px;
    }
    .h1{margin:0;text-align:center;font-weight:1000;letter-spacing:.6px;color:var(--orange);font-size:22px}
    .h2{margin:6px 0 0;text-align:center;font-weight:900;font-size:14px}
    .h3{margin:4px 0 14px;text-align:center;color:var(--muted);font-size:12px}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:780px){ .grid{grid-template-columns:1fr} }

    .card{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:14px;
    }
    .label{font-weight:1000;color:var(--text);opacity:.9;font-size:12px;margin-bottom:8px}
    .pin{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      outline:none;
      background:rgba(0,0,0,.25);
      color:var(--text);
      font-weight:900;
      letter-spacing:.6px;
    }
    .rowbtn{margin-top:10px}
    .btn{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:0;
      cursor:pointer;
      font-weight:1000;
      letter-spacing:.3px;
    }
    .btn.green{background:var(--green);color:#04140c}
    .btn.blue{background:var(--blue);color:#061225}
    .btn:hover{filter:brightness(1.05)}

    .foot{margin-top:10px;text-align:center;color:var(--muted);font-size:12px;font-weight:800}
    .loginMsg{margin-top:10px;text-align:center;color:var(--red);font-weight:1000;min-height:18px}
  </style>
</head>

<body>

  <div class="topbar">
    <div class="topbar-inner">
      <div class="logo">T</div>
      <div class="titlewrap">
        <div class="t1">Tesoura — Controle do Futebol</div>
        <div class="t2">Acesso da Diretoria (edita).</div>
      </div>

      <div class="spacer"></div>

      <div id="badge" class="badge">JOGADOR (VISUAL)</div>
      <button id="btnLogin" class="btnTop orange" type="button">LOGIN</button>
      <button id="btnSair" class="btnTop" type="button">SAIR</button>
    </div>

    <div class="tabs">
      <button id="aba-jogadores" class="tab" type="button">JOGADORES</button>
      <button id="aba-presenca" class="tab" type="button">PRESENÇA / ESCALAÇÃO</button>
      <button id="aba-controle" class="tab active" type="button">CONTROLE GERAL</button>
      <button id="aba-mensalidade" class="tab" type="button">MENSALIDADE</button>
      <button id="aba-caixa" class="tab" type="button">CAIXA</button>
      <button id="aba-gols" class="tab" type="button">GOLS</button>
      <button id="aba-banco" class="tab" type="button">BANCO DE DADOS</button>
    </div>
  </div>

  <div class="wrap">
          <div class="frameWrap" id="frameWrap">
        <div id="frameMask" class="frameMask hidden" aria-hidden="true">
          <div class="spinner" aria-hidden="true"></div>
        </div>

        <!-- iframes separados: evita "flash" do painel anterior -->
        <iframe id="frame_jogadores" class="frame" data-src="tesoura_jogadores_teste.html?v=20260101_anti_flash" title="JOGADORES"></iframe>
        <iframe id="frame_presenca" class="frame" data-src="tesoura_presenca_escala_R5.html?v=20260101_anti_flash" title="PRESENÇA / ESCALAÇÃO"></iframe>
        <iframe id="frame_controle" class="frame" data-src="tesoura_controle_geral_teste.html?v=20260101_anti_flash" title="CONTROLE GERAL"></iframe>
        <iframe id="frame_mensalidade" class="frame" data-src="tesoura_mensalidade_R4.html?v=20260101_anti_flash" title="MENSALIDADE"></iframe>
        <iframe id="frame_caixa" class="frame" data-src="tesoura_caixa_teste.html?v=20260101_anti_flash" title="CAIXA"></iframe>
        <iframe id="frame_gols" class="frame" data-src="tesoura_gols_teste.html?v=20260101_anti_flash" title="GOLS"></iframe>
        <iframe id="frame_banco" class="frame" data-src="tesoura_banco_dados_teste.html?v=20260101_anti_flash" title="BANCO DE DADOS"></iframe>
      </div><div id="msg" class="msg"></div>
  </div>

  <!-- LOGIN -->
  <div id="overlay" class="overlay">
    <div class="modal">
      <p class="h1">GRUPO TESOURA !</p>
      <p class="h2">ESPORTE, FAMÍLIA E AMIZADE</p>
      <p class="h3">Digite a senha e escolha o acesso</p>

      <div class="grid">
        <div class="card">
          <div class="label">JOGADORES (VISUAL)</div>
          <input id="senhaJogador" class="pin" type="text" inputmode="text" autocomplete="off" placeholder="Senha do jogador" />
          <div class="rowbtn">
            <button id="btnEntrarJogadores" class="btn green" type="button">ENTRAR JOGADORES</button>
          </div>
        </div>

        <div class="card">
          <div class="label">DIRETORIA (EDITA)</div>
          <input id="senhaDiretor" class="pin" type="text" inputmode="text" autocomplete="off" placeholder="Senha da diretoria" />
          <div class="rowbtn">
            <button id="btnEntrarDiretoria" class="btn blue" type="button">ENTRAR DIRETORIA</button>
          </div>
        </div>
      </div>

      <div class="foot">Regra: Jogador só visualiza (não edita). Diretor edita.</div>
      <div id="loginMsg" class="loginMsg"></div>
    </div>
  </div>

<script>
  // ============================================================
  // TESOURA - INDEX (ANTI-FLASH)
  // - 1 iframe por painel (carrega 1x e reaproveita)
  // - máscara durante troca (não mostra painel anterior)
  // ============================================================

  const V = "20260101_anti_flash";

  const frameWrap = document.getElementById("frameWrap");
  const frameMask = document.getElementById("frameMask");

  const frames = {
    jogadores: document.getElementById("frame_jogadores"),
    presenca: document.getElementById("frame_presenca"),
    controle: document.getElementById("frame_controle"),
    mensalidade: document.getElementById("frame_mensalidade"),
    caixa: document.getElementById("frame_caixa"),
    gols: document.getElementById("frame_gols"),
    banco: document.getElementById("frame_banco"),
  };

  const btns = {
    jogadores: document.getElementById("btnJogadores"),
    presenca: document.getElementById("btnPresenca"),
    controle: document.getElementById("btnControle"),
    mensalidade: document.getElementById("btnMensalidade"),
    caixa: document.getElementById("btnCaixa"),
    gols: document.getElementById("btnGols"),
    banco: document.getElementById("btnBanco"),
  };

  const badge = document.getElementById("badge");
  const modal = document.getElementById("loginModal");
  const passJog = document.getElementById("passJog");
  const passDir = document.getElementById("passDir");

  const btnAcessarJ = document.getElementById("btnAcessarJ");
  const btnAcessarD = document.getElementById("btnAcessarD");

  const btnLogin = document.getElementById("btnLogin");
  const btnSair = document.getElementById("btnSair");

  let can_caixa = false;
  let abaAtual = "controle";

  function showMask(on) {
    if (!frameMask) return;
    frameMask.classList.toggle("hidden", !on);
  }

  function setActiveButton(key) {
    Object.values(btns).forEach((b) => b && b.classList.remove("active"));
    if (btns[key]) btns[key].classList.add("active");
  }

  function getRole() {
    return (localStorage.getItem("TESOURA_ROLE") || "jogadores").toLowerCase();
  }

  function updateBadge() {
    const role = getRole();
    badge.textContent = (role === "diretoria") ? "DIRETORIA (COM CAIXA)" : "JOGADOR (VISUAL)";
  }

  function showLoginModal() {
    modal.style.display = "flex";
  }

  function hideLoginModal() {
    modal.style.display = "none";
  }

  function lockOneIframeForJogador(iframe, isJogador) {
    try {
      if (!iframe) return;
      if (isJogador) {
        // trava clique dentro do iframe (só visualização)
        iframe.setAttribute("sandbox", "allow-same-origin allow-scripts");
        iframe.style.pointerEvents = "none";
      } else {
        iframe.removeAttribute("sandbox");
        iframe.style.pointerEvents = "auto";
      }
    } catch (e) {}
  }

  function applyRoleToIframes() {
    const role = getRole();
    const isJogador = (role === "jogadores");
    Object.values(frames).forEach((f) => lockOneIframeForJogador(f, isJogador));
  }

  function ensureFrameLoaded(key) {
    const f = frames[key];
    if (!f) return Promise.resolve();

    if (f.dataset.loaded === "1") return Promise.resolve();

    // src lazy: carrega só quando precisa
    const src = f.getAttribute("data-src");
    if (!src) return Promise.resolve();

    return new Promise((resolve) => {
      f.addEventListener(
        "load",
        () => {
          f.dataset.loaded = "1";
          resolve();
        },
        { once: true }
      );
      f.src = src;
    });
  }

  async function abrirAba(key) {
    if (!frames[key]) return;

    abaAtual = key;
    setActiveButton(key);

    // máscara ON e esconde tudo antes de mostrar o alvo (evita "flash")
    showMask(true);
    Object.values(frames).forEach((f) => f.classList.remove("active"));

    const alvo = frames[key];
    alvo.classList.add("active");

    // carrega se necessário
    await ensureFrameLoaded(key);

    // aplica permissões
    applyRoleToIframes();
    updateBadge();

    // máscara OFF
    showMask(false);
  }

  // =========================
  // LOGIN / SAIR (globais)
  // =========================
  function TESOURA_ENTRAR_JOGADORES() {
    const senha = (passJog.value || "").trim();
    if (senha !== "TESOURA2026") {
      alert("Senha de JOGADORES inválida.");
      return;
    }
    localStorage.setItem("TESOURA_ROLE", "jogadores");
    can_caixa = false;
    hideLoginModal();
    updateBadge();
    applyRoleToIframes();
  }

  function TESOURA_ENTRAR_DIRETORIA() {
    const senha = (passDir.value || "").trim().toLowerCase();
    if (senha !== "1baidec") {
      alert("Senha de DIRETORIA inválida.");
      return;
    }
    localStorage.setItem("TESOURA_ROLE", "diretoria");
    can_caixa = true;
    hideLoginModal();
    updateBadge();
    applyRoleToIframes();
  }

  function TESOURA_SAIR() {
    localStorage.setItem("TESOURA_ROLE", "jogadores");
    can_caixa = false;
    updateBadge();
    applyRoleToIframes();
    showLoginModal();
  }

  // =========================
  // BOOT
  // =========================
  window.addEventListener("DOMContentLoaded", async () => {
    // botões login/sair
    btnLogin.addEventListener("click", showLoginModal);
    btnSair.addEventListener("click", TESOURA_SAIR);

    // botões modal
    btnAcessarJ.addEventListener("click", TESOURA_ENTRAR_JOGADORES);
    btnAcessarD.addEventListener("click", TESOURA_ENTRAR_DIRETORIA);

    // nav
    btns.jogadores.addEventListener("click", () => abrirAba("jogadores"));
    btns.presenca.addEventListener("click", () => abrirAba("presenca"));
    btns.controle.addEventListener("click", () => abrirAba("controle"));
    btns.mensalidade.addEventListener("click", () => abrirAba("mensalidade"));
    btns.caixa.addEventListener("click", () => {
      if (!can_caixa) {
        alert("Acesso ao CAIXA somente DIRETORIA.");
        return;
      }
      abrirAba("caixa");
    });
    btns.gols.addEventListener("click", () => abrirAba("gols"));
    btns.banco.addEventListener("click", () => abrirAba("banco"));

    // estado inicial
    updateBadge();
    applyRoleToIframes();
    showLoginModal();

    // abre painel padrão sem "flash"
    await abrirAba("controle");
  });
</script>

</body>
</html>
